<!DOCTYPE HTML>
<html>
	<head>
		<title>Home Automation</title>
		<script src="jquery-3.2.1.js"></script>
		<!--<meta http-equiv="refresh" content="5">-->
	</head>
	<body onload ="init()">

		Remote Light Switch<br>

		<button id="button1"
				type="button"
				onclick="return lightSwitchClick(this)"
				style="background-color:gray">
			off 
		</button>

		<br><br><br>

		<button id="reload"
				type="button"
				onclick="return actualizeStates()"
				style="background-color:gray">
			reload
		</button>

		<script type="text/javascript">   
			//setInterval(reload, 5000);

			//function reload() {
			//	location.reload(true);
			//}

			function init() {
				actualizeStates();
				//setInterval(actualizeStates, 1000);
			}

			function actualizeStates() {
				getLightState(button1);
				//there are more to come
			}

			function getLightState(button) {
				$.get('/arduino/msg/state/', function (data, status) { setLightState(data, button); });
			}

			function lightSwitchClick(button) {
				if (button.innerText == "off") {
					$.get('/arduino/msg/on/', function (data, status) { setLightState(data, button); });
					//button.style.backgroundColor = "yellow";
					//button.innerText = "on";
				} else {
					$.get('/arduino/msg/off/', function (data, status) { setLightState(data, button); });
					//button.style = "background-color:gray";
					//button.innerText = "off";
				}
				return false;
			}

			function setLightState(data, button) {
				if (data == "on") {
					button.style.backgroundColor = "yellow";
					button.innerText = "on";
				}
				else {
					button.style.backgroundColor = "gray";
					button.innerText = "off";
				}
			}
			
		</script>
	</body>
</html>